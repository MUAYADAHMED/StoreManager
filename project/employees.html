<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ† - Ø¯ÙØªØ± Ø­Ø³Ø§Ø¨Ø§Øª Ø§Ù„Ø¨ÙˆÙÙŠØ©</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/remixicon@3.5.0/fonts/remixicon.css" />
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: "#3B82F6",
            secondary: "#10B981",
            emerald: {
              50: '#f0fdf4',
              100: '#dcfce7',
              500: '#10b981',
              600: '#059669',
              700: '#047857',
              800: '#065f46',
            }
          },
          borderRadius: {
            none: "0px",
            sm: "4px",
            DEFAULT: "8px",
            md: "12px",
            lg: "16px",
            xl: "20px",
            "2xl": "24px",
            "3xl": "32px",
            full: "9999px",
            button: "8px",
          },
        },
      },
    };
  </script>
  <style>
    @import url("https://fonts.googleapis.com/css2?family=Tajawal:wght@300;400;500;700&display=swap");
    body {
      font-family: "Tajawal", sans-serif;
    }
    .fab {
      position: fixed;
      bottom: 80px;
      left: 20px;
      z-index: 40;
    }
    .bottom-nav {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      z-index: 30;
    }
    .content-area {
      padding-bottom: 100px;
    }
    .slide-in {
      animation: slideIn 0.3s ease-out;
    }
    @keyframes slideIn {
      from {
        transform: translateX(100%);
        opacity: 0;
      }
      to {
        transform: translateX(0);
        opacity: 1;
      }
    }
    .fade-in {
      animation: fadeIn 0.3s ease-out;
    }
    @keyframes fadeIn {
      from {
        opacity: 0;
      }
      to {
        opacity: 1;
      }
    }
  </style>
</head>
<body class="bg-gray-50">
  <!-- Header -->
  <div id="header"></div>

  <!-- Main Content -->
  <main class="container mx-auto px-4 py-6 content-area">
    <div class="mb-6">
      <!-- Summary Section -->
      <div class="mb-6">
        <div class="bg-white rounded-xl p-6 shadow-sm border">
          <div class="grid grid-cols-2 gap-4">
            <div class="text-center">
              <div class="w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-2">
                <i class="ri-team-fill text-blue-600 text-xl"></i>
              </div>
              <p class="text-2xl font-bold text-gray-800" id="totalEmployees">0</p>
              <p class="text-sm text-gray-500">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†</p>
            </div>
            <div class="text-center">
              <div class="w-12 h-12 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-2">
                <i class="ri-money-dollar-circle-fill text-green-600 text-xl"></i>
              </div>
              <p class="text-2xl font-bold text-gray-800" id="totalSalaries">0</p>
              <p class="text-sm text-gray-500">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø±ÙˆØ§ØªØ¨ (Ø±.Ø³)</p>
            </div>
          </div>
        </div>
      </div>
      
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4" id="employeesList">
        <!-- Employees will be loaded here -->
      </div>
    </div>
  </main>

  <!-- Floating Action Button -->
  <div id="floatingButton"></div>

  <!-- Bottom Navigation -->
  <div id="navbar"></div>

  <!-- Modal Container -->
  <div id="modalContainer"></div>

  <!-- Load common JS -->
  <script src="js/common.js"></script>

  <!-- Page specific script -->
  <script>
    // Override updateCurrentPageData from common.js
    function updateCurrentPageData() {
      renderEmployees();
      updateStats();
    }

    // Render employees
    function renderEmployees() {
      const container = document.getElementById("employeesList");
      container.innerHTML = "";

      appData.employees.forEach((employee) => {
        const balance = calculateEmployeeBalance(employee.id);
        const card = createEmployeeCard({
          id: employee.id,
          name: employee.name,
          balance: balance,
          phone: employee.phone,
        });
        container.appendChild(card);
      });
    }

    // Create employee card
    function createEmployeeCard(data) {
      const card = document.createElement("div");
      card.className = "bg-white rounded-lg shadow-md hover:shadow-lg transition-shadow p-6 border border-gray-200";

      const balanceColor = data.balance >= 0 ? "text-green-600" : "text-red-600";
      const balanceIcon = data.balance >= 0 ? "fa-arrow-up" : "fa-arrow-down";

      card.innerHTML = `
        <div class="flex items-center justify-between mb-4">
          <div class="flex items-center">
            <div class="w-12 h-12 bg-gradient-to-br from-blue-500 to-blue-600 rounded-full flex items-center justify-center text-white font-bold text-lg">
              ${data.name.charAt(0)}
            </div>
            <div class="mr-3">
              <h3 class="font-bold text-lg">${data.name}</h3>
            </div>
          </div>
          <div class="text-right">
            <p class="text-sm text-gray-600">Ø§Ù„Ø±ØµÙŠØ¯</p>
            <p class="${balanceColor} font-bold text-lg">
              <i class="fas ${balanceIcon} ml-1"></i>
              ${Math.abs(data.balance).toLocaleString("ar-EG")}
            </p>
          </div>
        </div>
        <div class="flex flex-wrap gap-2 justify-end">
          <button onclick="addAdvance(${data.id})" class="bg-yellow-600 hover:bg-yellow-700 text-white px-3 py-1 rounded text-sm transition" title="Ø¥Ø¶Ø§ÙØ© Ù…ØµØ±ÙˆÙ">
            <i class="fas fa-hand-holding-usd ml-1"></i>Ù…ØµØ±ÙˆÙ
          </button>
          <button onclick="addDeduction(${data.id})" class="bg-red-600 hover:bg-red-700 text-white px-3 py-1 rounded text-sm transition" title="Ø¥Ø¶Ø§ÙØ© Ø®ØµÙ…">
            <i class="fas fa-minus-circle ml-1"></i>Ø®ØµÙ…
          </button>
          <button onclick="showSalaryDelivery(${data.id})" class="bg-green-600 hover:bg-green-700 text-white px-3 py-1 rounded text-sm transition" title="ØªØ³Ù„ÙŠÙ… Ø±Ø§ØªØ¨">
            <i class="fas fa-money-check ml-1"></i>ØªØ³Ù„ÙŠÙ… Ø±Ø§ØªØ¨
          </button>
          <button onclick="goToEmployeeDetails(${data.id})" class="bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 rounded text-sm transition" title="ÙƒØ´Ù Ø§Ù„Ø­Ø³Ø§Ø¨">
            <i class="fas fa-list-alt ml-1"></i>ÙƒØ´Ù
          </button>
          <button onclick="editEmployee(${data.id})" class="bg-purple-600 hover:bg-purple-700 text-white px-3 py-1 rounded text-sm transition" title="ØªØ¹Ø¯ÙŠÙ„">
            <i class="fas fa-edit ml-1"></i>ØªØ¹Ø¯ÙŠÙ„
          </button>
          <button onclick="deleteEmployee(${data.id})" class="bg-red-500 hover:bg-red-600 text-white px-3 py-1 rounded text-sm transition" title="Ø­Ø°Ù">
            <i class="fas fa-trash ml-1"></i>Ø­Ø°Ù
          </button>
        </div>
      `;

      return card;
    }

    // Calculate employee balance
    function calculateEmployeeBalance(employeeId) {
      const employee = appData.employees.find((e) => e.id === employeeId);
      if (!employee) return 0;

      let balance = 0;
      employee.transactions.forEach((t) => {
        if (t.type === "advance") balance += t.amount;
        else if (t.type === "deduction") balance += t.amount;
        else if (t.type === "salary") balance -= t.amount;
      });

      return balance;
    }

    // Update statistics
    function updateStats() {
      document.getElementById("totalEmployees").textContent = appData.employees.length;
      
      let totalSalaries = 0;
      appData.employees.forEach(employee => {
        totalSalaries += employee.salary || 0;
      });
      
      document.getElementById("totalSalaries").textContent = totalSalaries.toLocaleString("ar-EG");
    }

    // Show add modal
    function showAddModal() {
      let modalContent = `
        <h3 class="text-xl font-bold mb-4">Ø¥Ø¶Ø§ÙØ© Ù…ÙˆØ¸Ù Ø¬Ø¯ÙŠØ¯</h3>
        <form onsubmit="addNewEmployee(event)">
          <div class="mb-4">
            <label class="block text-gray-700 mb-2">Ø§Ø³Ù… Ø§Ù„Ù…ÙˆØ¸Ù</label>
            <input type="text" required class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" name="name">
          </div>
          <div class="mb-4">
            <label class="block text-gray-700 mb-2">Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ</label>
            <input type="tel" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" name="phone">
          </div>
          <div class="mb-4">
            <label class="block text-gray-700 mb-2">Ø§Ù„Ø±Ø§ØªØ¨ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ</label>
            <input type="number" required class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" name="salary">
          </div>
          <div class="flex gap-3">
            <button type="submit" class="flex-1 bg-blue-600 hover:bg-blue-700 text-white py-2 rounded-lg transition">
              Ø¥Ø¶Ø§ÙØ©
            </button>
            <button type="button" onclick="closeModal()" class="flex-1 bg-gray-300 hover:bg-gray-400 text-gray-700 py-2 rounded-lg transition">
              Ø¥Ù„ØºØ§Ø¡
            </button>
          </div>
        </form>
      `;

      showModal(modalContent);
    }

    // Add new employee
    function addNewEmployee(event) {
      event.preventDefault();
      const formData = new FormData(event.target);
      const newEmployee = {
        id: Date.now(),
        name: formData.get("name"),
        phone: formData.get("phone"),
        salary: parseFloat(formData.get("salary")),
        transactions: [],
      };

      appData.employees.push(newEmployee);
      saveDataToLocalStorage();
      renderEmployees();
      updateStats();
      closeModal();
      showNotification("ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…ÙˆØ¸Ù Ø¨Ù†Ø¬Ø§Ø­", "success");
    }

    // Edit employee
    function editEmployee(employeeId) {
      const employee = appData.employees.find(e => e.id === employeeId);
      if (!employee) return;

      let modalContent = `
        <h3 class="text-xl font-bold mb-4">ØªØ¹Ø¯ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ÙˆØ¸Ù</h3>
        <form onsubmit="saveEmployeeEdit(event, ${employeeId})">
          <div class="mb-4">
            <label class="block text-gray-700 mb-2">Ø§Ø³Ù… Ø§Ù„Ù…ÙˆØ¸Ù</label>
            <input type="text" required value="${employee.name}" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" name="name">
          </div>
          <div class="mb-4">
            <label class="block text-gray-700 mb-2">Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ</label>
            <input type="tel" value="${employee.phone || ''}" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" name="phone">
          </div>
          <div class="mb-4">
            <label class="block text-gray-700 mb-2">Ø§Ù„Ø±Ø§ØªØ¨ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ</label>
            <input type="number" required value="${employee.salary}" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" name="salary">
          </div>
          <div class="flex gap-3">
            <button type="submit" class="flex-1 bg-blue-600 hover:bg-blue-700 text-white py-2 rounded-lg transition">
              Ø­ÙØ¸
            </button>
            <button type="button" onclick="closeModal()" class="flex-1 bg-gray-300 hover:bg-gray-400 text-gray-700 py-2 rounded-lg transition">
              Ø¥Ù„ØºØ§Ø¡
            </button>
          </div>
        </form>
      `;

      showModal(modalContent);
    }

    // Save employee edit
    function saveEmployeeEdit(event, employeeId) {
      event.preventDefault();
      const formData = new FormData(event.target);
      const employee = appData.employees.find(e => e.id === employeeId);
      
      if (employee) {
        employee.name = formData.get("name");
        employee.phone = formData.get("phone");
        employee.salary = parseFloat(formData.get("salary"));
        
        saveDataToLocalStorage();
        renderEmployees();
        updateStats();
        closeModal();
        showNotification("ØªÙ… ØªØ­Ø¯ÙŠØ« Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ÙˆØ¸Ù Ø¨Ù†Ø¬Ø§Ø­", "success");
      }
    }

    // Delete employee
    function deleteEmployee(employeeId) {
      const employee = appData.employees.find(e => e.id === employeeId);
      const transactionsCount = employee ? employee.transactions.length : 0;
      
      let confirmMsg = `Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ø§Ù„Ù…ÙˆØ¸Ù: "${employee?.name}"?\n\n`;
      if (transactionsCount > 0) {
        confirmMsg += `âš ï¸ ØªØ­Ø°ÙŠØ±: Ø³ÙŠØªÙ… Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ù…Ø¹Ø§Ù…Ù„Ø§Øª Ù‡Ø°Ø§ Ø§Ù„Ù…ÙˆØ¸Ù (${transactionsCount} Ù…Ø¹Ø§Ù…Ù„Ø©)!`;
      }
      
      if (confirm(confirmMsg)) {
        appData.employees = appData.employees.filter(e => e.id !== employeeId);
        saveDataToLocalStorage();
        renderEmployees();
        updateStats();
        showNotification("ØªÙ… Ø­Ø°Ù Ø§Ù„Ù…ÙˆØ¸Ù ÙˆØ¬Ù…ÙŠØ¹ Ù…Ø¹Ø§Ù…Ù„Ø§ØªÙ‡ Ø¨Ù†Ø¬Ø§Ø­", "success");
      }
    }

    // Show modal
    function showModal(content) {
      const modal = document.createElement("div");
      modal.className = "fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4";
      modal.innerHTML = `
        <div class="bg-white rounded-lg shadow-xl max-w-md w-full p-6 slide-in">
          ${content}
        </div>
      `;
      document.getElementById("modalContainer").appendChild(modal);
    }

    // Close modal
    function closeModal() {
      document.getElementById("modalContainer").innerHTML = "";
    }

    // Add advance
    function addAdvance(employeeId) {
      const employee = appData.employees.find((e) => e.id === employeeId);
      let modalContent = `
        <h3 class="text-xl font-bold mb-4">Ø¥Ø¶Ø§ÙØ© Ù…ØµØ±ÙˆÙ - ${employee.name}</h3>
        <form onsubmit="saveAdvance(event, ${employeeId})">
          <div class="mb-4">
            <label class="block text-gray-700 mb-2">Ù…Ø¨Ù„Øº Ø§Ù„Ù…ØµØ±ÙˆÙ</label>
            <input type="number" required class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" name="amount">
          </div>
          <div class="mb-4">
            <label class="block text-gray-700 mb-2">Ù…Ù„Ø§Ø­Ø¸Ø§Øª</label>
            <textarea class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" name="notes" rows="3"></textarea>
          </div>
          <div class="flex gap-3">
            <button type="submit" class="flex-1 bg-yellow-600 hover:bg-yellow-700 text-white py-2 rounded-lg transition">
              Ø­ÙØ¸ Ø§Ù„Ù…ØµØ±ÙˆÙ
            </button>
            <button type="button" onclick="closeModal()" class="flex-1 bg-gray-300 hover:bg-gray-400 text-gray-700 py-2 rounded-lg transition">
              Ø¥Ù„ØºØ§Ø¡
            </button>
          </div>
        </form>
      `;

      showModal(modalContent);
    }

    // Save advance
    function saveAdvance(event, employeeId) {
      event.preventDefault();
      const formData = new FormData(event.target);
      const amount = parseFloat(formData.get("amount"));
      const notes = formData.get("notes");

      if (amount <= 0) {
        showNotification("ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ù…Ø¨Ù„Øº ØµØ­ÙŠØ­", "error");
        return;
      }

      const employee = appData.employees.find((e) => e.id === employeeId);
      employee.transactions.push({
        id: Date.now(),
        type: "advance",
        amount: amount,
        date: new Date().toISOString(),
        description: notes || "Ù…ØµØ±ÙˆÙ Ø¬Ø¯ÙŠØ¯",
      });

      saveDataToLocalStorage();
      renderEmployees();
      closeModal();
      showNotification("ØªÙ… Ø­ÙØ¸ Ø§Ù„Ù…ØµØ±ÙˆÙ Ø¨Ù†Ø¬Ø§Ø­", "success");
    }

    // Add deduction
    function addDeduction(employeeId) {
      const employee = appData.employees.find((e) => e.id === employeeId);
      let modalContent = `
        <h3 class="text-xl font-bold mb-4">Ø¥Ø¶Ø§ÙØ© Ø®ØµÙ… - ${employee.name}</h3>
        <form onsubmit="saveDeduction(event, ${employeeId})">
          <div class="mb-4">
            <label class="block text-gray-700 mb-2">Ù…Ø¨Ù„Øº Ø§Ù„Ø®ØµÙ…</label>
            <input type="number" required class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" name="amount">
          </div>
          <div class="mb-4">
            <label class="block text-gray-700 mb-2">Ø³Ø¨Ø¨ Ø§Ù„Ø®ØµÙ…</label>
            <textarea class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" name="reason" rows="3"></textarea>
          </div>
          <div class="flex gap-3">
            <button type="submit" class="flex-1 bg-red-600 hover:bg-red-700 text-white py-2 rounded-lg transition">
              Ø­ÙØ¸ Ø§Ù„Ø®ØµÙ…
            </button>
            <button type="button" onclick="closeModal()" class="flex-1 bg-gray-300 hover:bg-gray-400 text-gray-700 py-2 rounded-lg transition">
              Ø¥Ù„ØºØ§Ø¡
            </button>
          </div>
        </form>
      `;

      showModal(modalContent);
    }

    // Save deduction
    function saveDeduction(event, employeeId) {
      event.preventDefault();
      const formData = new FormData(event.target);
      const amount = parseFloat(formData.get("amount"));
      const reason = formData.get("reason");

      if (amount <= 0) {
        showNotification("ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ù…Ø¨Ù„Øº ØµØ­ÙŠØ­", "error");
        return;
      }

      const employee = appData.employees.find((e) => e.id === employeeId);
      employee.transactions.push({
        id: Date.now(),
        type: "deduction",
        amount: amount,
        date: new Date().toISOString(),
        description: reason || "Ø®ØµÙ… Ø¬Ø¯ÙŠØ¯",
      });

      saveDataToLocalStorage();
      renderEmployees();
      closeModal();
      showNotification("ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø®ØµÙ… Ø¨Ù†Ø¬Ø§Ø­", "success");
    }

    // Show salary delivery form
    function showSalaryDelivery(employeeId) {
      const employee = appData.employees.find((e) => e.id === employeeId);
      
      // Calculate deductions (Ù…ØµØ§Ø±ÙŠÙ + Ø®ØµÙˆÙ…)
      let totalDeductions = 0;
      employee.transactions.forEach((t) => {
        if (t.type === "advance" || t.type === "deduction") {
          totalDeductions += t.amount;
        }
      });
      
      // Calculate paid salaries
      let paidSalaries = 0;
      employee.transactions.forEach((t) => {
        if (t.type === "salary") {
          paidSalaries += t.amount;
        }
      });
      
      const basicSalary = employee.salary || 0;
      const remaining = basicSalary - totalDeductions - paidSalaries;
      
      let modalContent = `
        <h3 class="text-xl font-bold mb-6 text-center">ØªØ³Ù„ÙŠÙ… Ø±Ø§ØªØ¨ - ${employee.name}</h3>
        
        <div class="bg-gray-50 p-4 rounded-lg mb-6 space-y-3">
          <div class="flex justify-between items-center pb-2 border-b">
            <span class="text-gray-700">Ø§Ù„Ø±Ø§ØªØ¨ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ:</span>
            <span class="font-bold text-green-600">${basicSalary.toLocaleString("ar-EG")} Ø¬.Ù…</span>
          </div>
          
          <div class="flex justify-between items-center pb-2 border-b">
            <span class="text-gray-700">Ø§Ù„Ø®ØµÙˆÙ… ÙˆØ§Ù„Ù…ØµØ§Ø±ÙŠÙ:</span>
            <span class="font-bold text-red-600">(${totalDeductions.toLocaleString("ar-EG")}) Ø¬.Ù…</span>
          </div>
          
          <div class="flex justify-between items-center pb-2 border-b">
            <span class="text-gray-700">Ø§Ù„Ø±Ø§ØªØ¨ Ø§Ù„Ù…Ø³Ø¯Ø¯ Ø³Ø§Ø¨Ù‚Ø§Ù‹:</span>
            <span class="font-bold text-blue-600">(${paidSalaries.toLocaleString("ar-EG")}) Ø¬.Ù…</span>
          </div>
          
          <div class="flex justify-between items-center pt-2 border-t-2">
            <span class="text-lg font-bold">Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ Ù„Ù„ØªØ³Ù„ÙŠÙ…:</span>
            <span class="text-xl font-bold ${remaining >= 0 ? 'text-green-600' : 'text-red-600'}">
              ${remaining >= 0 ? '' : '('}${Math.abs(remaining).toLocaleString("ar-EG")}${remaining >= 0 ? '' : ')'} Ø¬.Ù…
            </span>
          </div>
        </div>
        
        <form onsubmit="recordSalaryPayment(event, ${employeeId})">
          <div class="mb-4">
            <label class="block text-gray-700 mb-2">Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…Ø³Ø¯Ø¯</label>
            <input type="number" required value="${remaining}" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500" name="amount">
          </div>
          
          <div class="mb-4">
            <label class="block text-gray-700 mb-2">Ù…Ù„Ø§Ø­Ø¸Ø§Øª (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
            <textarea class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500" name="notes" rows="2"></textarea>
          </div>
          
          <div class="flex gap-3">
            <button type="submit" class="flex-1 bg-green-600 hover:bg-green-700 text-white py-2 rounded-lg transition font-semibold">
              ØªØ³Ø¯ÙŠØ¯ Ø§Ù„Ø±Ø§ØªØ¨
            </button>
            <button type="button" onclick="closeModal()" class="flex-1 bg-gray-300 hover:bg-gray-400 text-gray-700 py-2 rounded-lg transition">
              Ø¥Ù„ØºØ§Ø¡
            </button>
          </div>
        </form>
      `;

      showModal(modalContent);
    }

    // Record salary payment
    function recordSalaryPayment(event, employeeId) {
      event.preventDefault();
      const formData = new FormData(event.target);
      const amount = parseFloat(formData.get("amount"));
      const notes = formData.get("notes");

      if (amount <= 0) {
        showNotification("ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ù…Ø¨Ù„Øº ØµØ­ÙŠØ­", "error");
        return;
      }

      const employee = appData.employees.find((e) => e.id === employeeId);
      employee.transactions.push({
        id: Date.now(),
        type: "salary",
        amount: amount,
        date: new Date().toISOString(),
        description: notes || "ØªØ³Ø¯ÙŠØ¯ Ø±Ø§ØªØ¨",
      });

      saveDataToLocalStorage();
      renderEmployees();
      closeModal();
      showNotification("ØªÙ… ØªØ³Ø¯ÙŠØ¯ Ø§Ù„Ø±Ø§ØªØ¨ Ø¨Ù†Ø¬Ø§Ø­", "success");
    }

    // Go to employee details page
    function goToEmployeeDetails(employeeId) {
      window.location.href = `employee-details.html?id=${employeeId}`;
    }

    // Show statement (Ù…ÙˆØ¬ÙˆØ¯ ÙÙŠ showStatement Ù„Ù„Ù†Ù…ÙˆØ°Ø¬)
    function showStatement(employeeId) {
      const employee = appData.employees.find(e => e.id === employeeId);
      const transactions = employee.transactions;

      let modalContent = `
        <h3 class="text-xl font-bold mb-4">ÙƒØ´Ù Ø­Ø³Ø§Ø¨ - ${employee.name}</h3>
        <div class="max-h-96 overflow-y-auto">
          <table class="w-full">
            <thead>
              <tr class="border-b">
                <th class="text-right p-2">Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
                <th class="text-right p-2">Ø§Ù„ÙˆØµÙ</th>
                <th class="text-right p-2">Ø§Ù„Ù…Ø¨Ù„Øº</th>
                <th class="text-right p-2">Ø§Ù„Ø±ØµÙŠØ¯</th>
              </tr>
            </thead>
            <tbody>
      `;

      let balance = 0;
      transactions
        .sort((a, b) => new Date(b.date) - new Date(a.date))
        .forEach((t) => {
          const date = new Date(t.date).toLocaleDateString("ar-EG");
          const typeText = t.type === "advance" ? "Ù…ØµØ±ÙˆÙ" : t.type === "deduction" ? "Ø®ØµÙ…" : "Ø±Ø§ØªØ¨";
          const amountClass = t.type === "salary" ? "text-green-600" : "text-red-600";

          if (t.type === "advance" || t.type === "deduction") {
            balance += t.amount;
          } else {
            balance -= t.amount;
          }

          modalContent += `
            <tr class="border-b hover:bg-gray-50">
              <td class="p-2">${date}</td>
              <td class="p-2">${t.description}</td>
              <td class="p-2 ${amountClass}">${t.amount.toLocaleString("ar-EG")} Ø¬.Ù…</td>
              <td class="p-2 font-medium">${balance.toLocaleString("ar-EG")} Ø¬.Ù…</td>
            </tr>
          `;
        });

      modalContent += `
            </tbody>
          </table>
        </div>
        <div class="mt-4 flex justify-end">
          <button onclick="closeModal()" class="bg-gray-300 hover:bg-gray-400 text-gray-700 px-4 py-2 rounded-lg transition">
            Ø¥ØºÙ„Ø§Ù‚
          </button>
        </div>
      `;

      showModal(modalContent);
    }

    // Load components when DOM is ready
    document.addEventListener("DOMContentLoaded", function() {
      loadComponent('header', 'components/header.html');
      loadComponent('navbar', 'components/navbar.html');
      loadComponent('floatingButton', 'components/floating-button.html');
      
      // Set FAB action for this page - Add employee
      setTimeout(() => {
        setFabAction(showAddModal, 'fa-user-plus', 'blue');
      }, 500);
    });

    // When user returns to page (back button), reload data from data.json
    window.addEventListener('pageshow', function() {
      console.log('ğŸ“„ Ø¹ÙˆØ¯Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù„ØµÙØ­Ø© Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ† - Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...');
      loadData();
    });
  </script>
</body>
</html>